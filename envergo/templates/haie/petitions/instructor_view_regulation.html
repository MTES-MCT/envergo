{% extends "haie/petitions/instructor_view_base.html" %}

{% load moulinette %}
{% load utils %}
{% load petitions %}

{% load static %}

{% block title %}Instruction du dossier – {{ current_regulation }}{% endblock %}

{% block project_content %}

  <div class="project-inner-content">

    <form method="post"
          action="{% url 'petition_project_instructor_regulation_view' petition_project.reference current_regulation.slug %}">
      {% csrf_token %}

      {% for regulation in moulinette.regulations %}
        {% if regulation.slug == current_regulation.slug %}
          <section class="fr-my-3w" id="{{ regulation.slug }}">
            <h1>{{ regulation.title }}</h1>
            <div class="title-with-link-container">
              <h2 class="fr-mr-8w">Résultats de la simulation</h2>
              <a class="fr-link fr-icon-arrow-right-line fr-link--icon-right fr-mb-3w"
                 href="{% url 'petition_project' petition_project.reference %}">Voir le résultat</a>
            </div>

            {% include 'haie/moulinette/_result_regulation.html' with regulation=regulation %}

            {% if regulation.has_instructor_result_details_templates %}
              <h3>Détails du résultat de la simulation</h3>
              {% for criterion in regulation.criteria.all %}
                <section id="{{ regulation.slug }}-{{ criterion.slug }}">
                  {% criterion_instructor_result_details regulation criterion petition_project moulinette %}
                </section>
              {% endfor %}
            {% endif %}
            {% regulation_has_condition_to_display plantation_evaluation regulation as has_condition_to_display %}
            {% if has_condition_to_display %}
              <h3>Acceptabilité de la plantation</h3>
              <section>
                <p>Conditions de plantation à respecter pour cette réglementation :</p>
                {% regulation_plantation_conditions plantation_evaluation regulation %}
              </section>
            {% endif %}
            {% for criterion in regulation.criteria.all %}
              <section id="{{ regulation.slug }}-{{ criterion.slug }}">
                {% criterion_instructor_view regulation criterion petition_project moulinette %}
              </section>
            {% empty %}
              <p>Cette réglementation n’est pas disponible pour ce projet.</p>
            {% endfor %}
          </section>
        {% endif %}
      {% endfor %}
    </form>

  </div>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script>var HEDGES_PLANTATION_URL = "{{ plantation_url|safe }}";</script>
  <script>var SOURCE_PAGE = "instruction";</script>
  <script defer src="{% static 'js/libs/hedges_input.js' %}"></script>
  <script defer src="{% static 'js/libs/form_project_instruction.js' %}"></script>
{% endblock %}
