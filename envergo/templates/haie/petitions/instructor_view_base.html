{% extends "base.html" %}

{% load static %}

{% block title %}Instruction du dossier{% endblock %}

{% block container %}

  <section class="fr-py-8w">
    <div class="fr-container">
      <div class="fr-grid-row">
        <div class="fr-col fr-col-12 fr-col-md-3">
          <nav class="fr-sidemenu fr-sidemenu--sticky"
               aria-labelledby="fr-sidemenu-title">
            <div class="fr-sidemenu__inner">
              <div id="fr-sidemenu-wrapper">
                <ul class="fr-sidemenu__list">

                  {% block project_sidemenu %}
                    {% with request.resolver_match.url_name as url_name %}
                      <li class="fr-sidemenu__item{% if url_name == 'petition_project_instructor_view' %} fr-sidemenu__item--active{% endif %}">
                        <a class="fr-sidemenu__link"
                           href="{% url 'petition_project_instructor_view' petition_project.reference %}"
                           {% if url_name == 'petition_project_instructor_view' %}aria-current="page"{% endif %}>
                        Informations générales</a>
                      </li>
                      {% for regulation in moulinette.regulations|dictsort:"display_order" %}
                        <li class="fr-sidemenu__item{% if regulation.slug == current_regulation.slug %} fr-sidemenu__item--active{% endif %}">
                          <a class="fr-sidemenu__link"
                             href="{% url 'petition_project_instructor_regulation_view' petition_project.reference regulation.slug %}"
                             {% if regulation.slug == current_regulation.slug %}aria-current="page"{% endif %}>
                          {{ regulation.title }}</a>
                        </li>
                      {% endfor %}
                      <li class="ds-item fr-sidemenu__item{% if url_name == 'petition_project_instructor_dossier_ds_view' %} fr-sidemenu__item--active{% endif %}">
                        <a class="fr-sidemenu__link"
                           href="{% url 'petition_project_instructor_dossier_ds_view' petition_project.reference %}"
                           {% if url_name == 'petition_project_instructor_dossier_ds_view' %}aria-current="page"{% endif %}>
                        Formulaire rempli sur Démarches simplifiées</a>

                        {% if url_name == 'petition_project_instructor_dossier_ds_view' and project_details.ds_data.header_sections %}
                          <div id="fr-sidemenu-item-1">
                            <ul class="fr-sidemenu__list">
                              {% for item in project_details.ds_data.header_sections %}
                                <li class="fr-sidemenu__item">
                                  <a class="fr-sidemenu__link"
                                     href="#section-{{ item|slugify }}"
                                     target="_self">{{ item }}</a>
                                </li>
                              {% endfor %}
                            </ul>
                          </div>
                        {% endif %}
                      </li>
                      <hr class="separator--lignt">
                      <li class="fr-sidemenu__item{% if url_name == 'petition_project_instructor_notes_view' %} fr-sidemenu__item--active{% endif %}">
                        <a class="fr-sidemenu__link"
                           href="{% url 'petition_project_instructor_notes_view' petition_project.reference %}"
                           {% if url_name == 'petition_project_instructor_notes_view' %}aria-current="page"{% endif %}>
                        Notes libres pour l'instruction</a>
                      </li>
                    {% endwith %}
                  {% endblock %}

                </ul>
              </div>
            </div>
          </nav>
        </div>
        <div id="project-specifications-instructor"
             class="fr-col fr-col-12 fr-col-md-9 fr-pl-10w">

          {% include 'haie/petitions/_summary_dossier.html' %}

          {% block project_content %}{% endblock %}

        </div>
      </div>
    </div>

  </section>

{% endblock %}
{% block extra_body %}
  {% include 'haie/petitions/_invitation_token_modal.html' %}
{% endblock %}

{% block extra_js %}
  <script>const INVITATION_TOKEN_URL = '{{ invitation_token_url }}';</script>
  <script defer src="{% static 'js/libs/invitation_token_modal.js' %}"></script>
  <script defer src="{% static 'js/libs/data_event_attributes_analytics.js' %}"></script>
{% endblock %}
