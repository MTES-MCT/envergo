{% extends 'haie/moulinette/result.html' %}

{% load evaluations static moulinette %}

{% block result %}

  <section class="debug">

    <h1>Paramètres de la moulinette</h1>

    <h2>Données initiales</h2>

    <ul>
      <li>Longueur à détruire : {{ haies.length_to_remove|floatformat:"g" }} m</li>
      <li>Longueur à planter : {{ haies.length_to_plant|floatformat:"g" }} m</li>

      {% if moulinette.config %}
        <li>
          Département : <a href="{% url 'admin:moulinette_configamenagement_change' moulinette.config.pk %}">{{ moulinette.department }}</a>
        </li>
      {% else %}
        <li>Département : {{ moulinette.department }}</li>
      {% endif %}
    </ul>

    <h2>Réglementations</h2>

    {% for regulation in moulinette.regulations %}
      <h3>{{ regulation.title }}</h3>
      <p>
        {% result_tag regulation.result regulation.result_tag_style %}
        <small>({{ regulation.result }})</small>
      </p>

      {% with criteria=regulation.criteria.all %}
        {% if criteria %}
          <ul>
            {% for criterion in criteria %}
              <li class="fr-mb-2w">
                {{ criterion.title }} : {% result_tag criterion.result criterion.result_tag_style %}
                <small>({{ criterion.result_code }})</small>
                <br />
                Déclenchement géographique : {{ criterion.activation_mode }}
                <br />
                {% if criterion.evaluator_settings.replantation_coefficient %}
                  R = {{ criterion.evaluator_settings.replantation_coefficient }}
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}
    {% endfor %}

    <h2>Catalogue de données</h2>

    <dd>
      {% for key, value in moulinette.catalog.items %}
        <dt>{{ key }}</dt>
        <dd>
          {{ value|truncatechars:150 }}
        </dd>
      {% endfor %}
    </dd>
  </section>
{% endblock %}
