{% extends 'haie/base.html' %}

{% load utils %}

{% block title %}
  Paramétrage {{ department }}
{% endblock title %}

{% block content %}
  <div class="fr-grid-row fr-mb-3w">
    <div class="fr-col fr-col-12 fr-col-offset-md-3 fr-col-md-9">
      <h1>Paramétrage du portail</h1>

      <p class="fr-text--lead">Département : {{ department }}</p>

      <h2>Configuration</h2>

      <p class="fr-mb-1w">
        <strong>Simulateur activé pour le département :</strong> {{ object.is_activated|yesno }}
      </p>
      <p>
        <strong>Régime unique :</strong> {{ object.single_procedure|yesno }}
      </p>

      <h2 id="title-cartes">Cartes</h2>
      <p class="fr-hint-text">
        Ici sont recensées toutes les cartes utilisées dans le simulateur pour le département.
        Les fichiers sont téléchargeables pour consultation et vérification (format compatible QGIS).
        Pour signaler une erreur ou poser une question, l'équipe Envergo est disponible.
      </p>

      {% regroup grouped_criteria by regulation as regulation_list %}
      {% for regulation in regulation_list %}
        <h3 class="fr-h5">{{ regulation.grouper }}</h3>

        <ul class="fr-mb-3w">
          {% for criterion in regulation.list %}
            {% with map=criterion.activation_map %}
              <li class="fr-mb-2w">
                <p class="fr-mb-1w">
                  <strong>{{ map.name }}</strong>
                </p>
                <p class="fr-mb-1w">
                  <strong>Description :</strong> {{ map.description|safe|linebreaksbr|urlize_html }}
                </p>
                {% if map.source %}
                  <p class="fr-hint-text fr-mb-1w">
                    <strong>Source :</strong>
                    {{ map.source|safe|linebreaksbr|urlize_html }}
                  </p>
                {% endif %}
                {% if map.file %}
                  <div class="fr-download">
                    <a class="fr-link fr-link--download"
                       download="true"
                       target="_self"
                       href="{{ map.file.url }}">{{ map.file }}</a>
                  </div>
                {% endif %}
              </li>
            {% endwith %}
          {% endfor %}

        </ul>
      {% empty %}
        <p>Aucune carte paramétrée.</p>
      {% endfor %}

      <h2 id="title-comptes">Comptes</h2>

      <div>
        <p class="fr-mb-1w">
          <strong>Liste des comptes ayant les droits instructeur sur le département :</strong>
        </p>

        {% if department_members.instructors_emails %}
          <ul>
            {% for member_email in department_members.instructors_emails %}<li>{{ member_email }}</li>{% endfor %}
          </ul>
        {% else %}
          <p>Pas de compte instructeur pour ce département.</p>
        {% endif %}
      </div>

      <div>
        <p class="fr-mb-1w">
          <strong>Liste des comptes ayant les droits invités sur le département :</strong>
        </p>
        {% if department_members.invited_emails %}
          <ul>
            {% for member_email in department_members.invited_emails %}<li>{{ member_email }}</li>{% endfor %}
          </ul>
        {% else %}
          <p>Pas de compte invité pour ce département.</p>
        {% endif %}
      </div>

    </div>
  </div>
{% endblock %}

{% block after-content %}{% endblock %}
