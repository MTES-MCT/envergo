{% extends 'haie/base.html' %}

{% load utils %}

{% block title %}
  Paramétrage {{ department }}
{% endblock title %}

{% block content %}
  <div class="fr-grid-row fr-mb-3w">
    <div class="fr-col fr-col-12 fr-col-offset-md-3 fr-col-md-6">
      <h1>Paramétrage du portail</h1>

      <p class="fr-text--lead">Département : {{ department }}</p>

      <h2>Configuration</h2>

      <p class="fr-mb-1w">
        <strong>Simulateur activé pour le département :</strong> {{ object.is_activated|yesno }}
      </p>
      <p>
        <strong>Régime unique :</strong> {{ object.single_procedure|yesno }}
      </p>

      <h2 id="title-cartes">Cartes</h2>
      <p class="fr-hint-text">
        Ici sont recensées toutes les cartes utilisées dans le simulateur pour le département.
        Les fichiers sont téléchargeables pour consultation et vérification (format compatible QGIS).
        Pour signaler une erreur ou poser une question, <a href="{% url 'contact_us' %}">l'équipe Envergo est disponible</a>.
      </p>

      {% for regulation in regulation_list %}
        <h3 class="fr-h5">{{ regulation.title }}</h3>
        {% if regulation.regulation in grouped_criteria %}
          <ul class="fr-mb-3w">
            {% for criterion in grouped_criteria|get_item:regulation.regulation %}
              {% with map=criterion.activation_map %}
                <li class="fr-mb-2w">
                  <p class="fr-mb-1w">
                    <strong>{{ map.name }}</strong>
                  </p>
                  <p class="fr-text--sm fr-mb-1w">
                    <strong>Description :</strong> {{ map.description|safe|linebreaksbr|urlize_html }}
                  </p>
                  {% if map.file %}
                    <div class="fr-mb-1w">
                      <a class="fr-link fr-icon-download-line fr-link--icon-right"
                         target="_self"
                         href="{{ map.file.url }}">{{ map.file }}</a>
                    </div>
                  {% endif %}
                </li>
              {% endwith %}
            {% endfor %}

          </ul>
        {% else %}
          <p>
            <em>Aucune carte paramétrée.</em>
          </p>
        {% endif %}
      {% endfor %}

      <h2 id="title-comptes">Comptes</h2>

      <div class="fr-mb-2w">
        <p class="fr-mb-1w">
          <strong>Liste des comptes ayant les droits de modification (services coordonnateurs) sur tous les dossiers du département :</strong>
        </p>

        {% if department_members.instructors_emails %}
          <ul>
            {% for member_email in department_members.instructors_emails %}<li>{{ member_email }}</li>{% endfor %}
          </ul>
        {% else %}
          <p>
            <em>Pas de compte instructeur pour ce département.</em>
          </p>
        {% endif %}
      </div>

      <div class="fr-mb-2w">
        <p class="fr-mb-1w">
          <strong>Liste des comptes ayant les droits de lecture sur tous les dossiers du département :</strong>
        </p>
        {% if department_members.invited_emails %}
          <ul>
            {% for member_email in department_members.invited_emails %}<li>{{ member_email }}</li>{% endfor %}
          </ul>
        {% else %}
          <p>
            <em>Pas de compte invité pour ce département.</em>
          </p>
        {% endif %}
      </div>
    </div>

    <div class="fr-mb-2w">
        <p class="fr-mb-1w">
          <strong>Outre les comptes listés ci-dessus, des comptes peuvent avoir été invités dossier par dossier. 
Ils ne sont pas recensés ici mais dans la vue «&nbsp;Services consultés&nbsp;» de chaque dossier.</strong>
        </p>
    </div>
  </div>
{% endblock %}

{% block after-content %}{% endblock %}
