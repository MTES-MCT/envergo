{% load utils %}

<form class="fr-mb-3w" method="post" novalidate autocomplete="off" action="" id="moulinette-form">
  {% csrf_token %}

  {% include '_form_header.html' with form=form %}

  <div id="form-group-coords" class="fr-input-group">

    {{ form.lng.as_hidden }}
    {{ form.lat.as_hidden }}

    <label>
      Saisissez une adresse, déplacez le marqueur ou double-cliquez pour indiquer
      l'emplacement de votre projet.
    </label>

    <div class="ratio-4x3 fr-mt-1w fr-mb-2w">
      <div class="ratio-content">
        <div class="leaflet-container">
          <div class="search-control">
            {{ form.address }}
          </div>
          <div id="map">
          </div>
        </div>
      </div>
    </div>

    {% if form.lat.errors or form.lng.errors %}
      <p class="fr-error-text">
        ↑
        Les coordonnées saisies sont incorrectes
        ↑
      </p>

    {% endif %}

  </div>

  {% include '_field_snippet.html' with field=form.created_surface %}
  {% include '_field_snippet.html' with field=form.existing_surface %}

  {% if additional_forms %}

    <hr />

    <p><strong>Questions(s) complémentaire(s)</strong></p>

    {% for additional_form in additional_forms %}
      {% for field in additional_form %}
        {% if field|is_checkbox %}
          {% include '_checkbox_snippet.html' with field=field %}
        {% elif field|is_radio %}
          {% include '_radio_snippet.html' with field=field %}
        {% elif field|is_input_file %}
          {% include '_input_file_snippet.html' with field=field %}
        {% else %}
          {% include '_field_snippet.html' with field=field %}
        {% endif %}
      {% endfor %}
    {% endfor %}

  {% endif %}

  {% if moulinette and moulinette.has_missing_data %}
    <button type="submit" class="fr-btn">Compléter l'évaluation</button>
  {% elif moulinette %}
    <button type="submit" class="fr-btn">Renouveler l'évaluation</button>
  {% else %}
    <button type="submit" class="fr-btn">Démarrer l'évaluation</button>
  {% endif %}
</form>
