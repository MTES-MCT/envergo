{% extends 'moulinette/base.html' %}

{% load evaluations static l10n %}

{% block header %}{% endblock %}

{% block body-classes %}moulinette-result-body{% endblock %}

{% block container %}

  <div id="project-result" class="fr-col">
    <section class="fr-py-4w fr-px-4w">
      {% block result %}{% endblock %}
    </section>
  </div>

  <div id="project-summary" class="fr-px-2w">
    <section>
      <h2 class="fr-mb-5w">Caractéristiques du projet</h2>
      <p class="fr-text print-only">
        Simulation réalisée sur
        <a title="EnvErgo : la réglementation environnementale pour les projets de construction et d'aménagement"
           href="{{ envergo_url }}"
           target="_blank"
           rel="noopener external">EnvErgo</a>
      </p>
      <p class="fr-text print-only">
        Cette simulation est
        <a title="Partager l'avis réglementaire"
           href="{{ share_print_url }}"
           target="_blank"
           class="share-link"
           rel="noopener external">consultable en ligne</a>
      </p>
      {% block project_summary %}{% endblock %}
      <div class="button-container  hide-print">
        <a href="{{ edit_url }}"
           class="fr-btn fr-btn--secondary fr-mt-3w fr-btn--icon-left fr-icon-arrow-left-line"
           data-event-category="Content"
           data-event-action="Edit"
           data-event-name="Project">Modifier le projet</a>
      </div>
    </section>
  </div>
{% endblock %}

{% block extra_body %}
  {% include '_share_url_modal.html' with title="Partager cette simulation" content='<p>Avec ce lien le destinataire pourra directement consulter cette page web présentant :</p> <ul class="fr-mb-0w"> <li>les mêmes caractéristiques de projet (localisation et surfaces) ;</li> <li>les mêmes résultats de simulation.</li> </ul>' shorten_url=True share_url=share_btn_url %}
  {% if display_feedback_form %}
    {% include 'analytics/_feedback_modal_useful.html' %}
    {% include 'analytics/_feedback_modal_useless.html' %}
  {% endif %}
{% endblock %}

{% block extra_js %}
  <script>
    var DEPARTMENT = "{{ moulinette.department.department }}";
    var CURRENT_URL = "{{ current_url|safe }}";
    window.MAPS = window.MAPS || {};
    window.MAPS['map'] = {
      center: {coordinates: [{{ center_map.0|unlocalize }}, {{ center_map.1|unlocalize }}]},
      entries: [],
      caption: null,
      truncate: true,
      zoom: 15,
      ratio: "4x3",
      fixed: {
        zoomControl: true,
        dragging: false,
        doubleClickZoom: 'center',
        scrollWheelZoom: false,
        touchZoom: 'center',
        keyboard: true,
      }
    };
    var FEEDBACK_MODAL_DIALOGS = '.feedback-dialog';
    var FEEDBACK_RESPOND_URL = '{% url "feedback_respond" %}';
    var VISITOR_ID = '{{ visitor_id }}';
    {% if moulinette_summary %}
      var MOULINETTE_DATA = {{ moulinette_summary|safe }};
    {% endif %}
  </script>

  <script defer src="{% static 'leaflet/dist/leaflet.js' %}"></script>
  <script defer src="{% static 'leaflet/draw/leaflet.draw.js' %}"></script>
  <script defer src="{% static 'js/libs/leaflet-icon-fix.js' %}"></script>
  <script defer src="{% static 'js/libs/moulinette_result_maps.js' %}"></script>
  <script defer src="{% static 'js/libs/moulinette_analytics.js' %}"></script>
  <script defer
          src="{% static 'js/libs/moulinette_result_actions_banner.js' %}"></script>
  <script defer src="{% static 'js/libs/urlmappings.js' %}"></script>
  <script defer src="{% static 'js/libs/share_url_modal.js' %}"></script>
  <script defer src="{% static 'js/libs/moulinette_print_buttons.js' %}"></script>
  <script defer src="{% static 'js/libs/feedback_form.js' %}"></script>
{% endblock %}
