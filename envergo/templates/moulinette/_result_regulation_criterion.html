{% load moulinette evaluations %}

<div class="fr-accordion fr-accordion--no-icon">
  <h4 class="fr-accordion__title">
    <button class="fr-accordion__btn" aria-expanded="false" aria-controls="read-more-{{ regulation.slug }}_{{ criterion.slug }}">
      {% result_tag criterion.result %}
      <span class="title">
        <strong>{{ criterion.title }}</strong><br >
        {{ criterion.subtitle }}
      </span>
    </button>

  </h4>

  <div class="fr-collapse" id="read-more-{{ regulation.slug }}_{{ criterion.slug }}">
    {% if criterion.header %}
      <p class="fr-text--light fr-text--sm">
        {{ criterion.header|safe }}
      </p>
    {% endif %}
    {% show_criterion_body regulation criterion %}

    {% if criterion.map %}
      <figure class="fr-content-media" role="group">
        <div class="ratio-4x3">
          <div class="ratio-content">
            <div class="leaflet-container">
              <div id="map-{{ criterion.slug }}"></div>
            </div>
          </div>
        </div>
        <figcaption class="fr-content-media__caption">
          {{ criterion.map.caption|safe }}
          <br />SourceÂ :
          {% for source in criterion.map.sources %}
            {% if source.url %}
              <a href="{{ source.url }}" target="_blank" rel="noopener">{{ source.display_name }}</a>
            {% else %}
              {{ source.display_name }}
            {% endif %}
            <br />
          {% endfor %}
        </figcaption>
      </figure>

      <script>
        console.log('CRITERIA_MAPS defined');
        window.CRITERIA_MAPS = window.CRITERIA_MAPS || {};
        window.CRITERIA_MAPS['map-{{ criterion.slug }}'] = {{ criterion.map.to_json|safe }};
      </script>

    {% endif %}
  </div>

  {% include 'moulinette/_read_more_btn.html' with aria_controls=regulation.slug|add:"_"|add:criterion.slug %}

</div>
