{% extends 'moulinette/base_result.html' %}
{% load evaluations static %}

{% block extra-form-col %}
  {% if display_feedback_form %}
    {% include 'analytics/_feedback_form.html' %}
  {% endif %}
{% endblock %}

{% block result %}

  <h1 class="fr-mb-5w">Réglementations environnementales : évaluation personnalisée</h1>

  {% for regulation in moulinette.regulations %}
    <button class="js fr-btn fr-btn--tertiary fr-btn--icon-left fr-icon-mail-fill fr-mt-3w fr-mb-5w share-btn" data-fr-opened="false" aria-controls="share-modal" data-btn="{{ regulation.slug }}">Partager cette page par email</button>

    {% include 'moulinette/_result_regulation.html' with regulation=regulation %}
  {% endfor %}

  <div class="fr-alert fr-alert--info fr-my-5w">
    <p>EnvErgo est un service du ministère de la transition écologique. Il vise à aider les acteurs de l'aménagement en phase amont de leurs projets.</p>
    <p><i>Les avis rendus ne valent pas position de l'administration</i>. Ils ne couvrent pas l'exhaustivité des réglementations spécifiques à certains projets.</p>
  </div>

  <section class="regulation regulation-disabled fr-mb-5w" id="regulation_natura200">
    <h2><span class="content">Évaluation environnementale</span> {% result_tag 'non_disponible' %}</h2>
    <p>Cette réglementation sera prochainement prise en compte dans EnvErgo.
      Vous pouvez <a target="_blank" rel="noopener" href="https://startupdetat.typeform.com/envergo-regl">voter pour la demander en priorité</a>.</p>

  </section>

{% endblock %}


{% block bottom_alt %}
  <h2>Besoin de partager cette évaluation à un contact ?</h2>

  <p>
    <button class="js fr-btn fr-btn--tertiary fr-btn--icon-left fr-icon-mail-fill share-btn" data-fr-opened="false" aria-controls="share-modal" data-btn="bottom">Partager cette page par email</button>
  </p>
  <p>Le destinataire pourra consulter cette page web avec les mêmes caractéristiques de projet et les mêmes résultats de simulation.</p>
{% endblock %}

{% block extra_body %}
  {% include 'moulinette/_share_modal.html' %}

  {% if display_feedback_form %}
    {% include 'analytics/_feedback_modal.html' %}
  {% endif %}

{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script defer src="{% static 'js/libs/moulinette_result_maps.js' %}"></script>
  <script defer src="{% static 'js/libs/moulinette_share_modal.js' %}"></script>
  <script>
    var _paq = window._paq || [];

    // Track an event when a regulation main "read more" btn is clicked
    window.addEventListener('load', function() {
      const showMoreBtns = document.querySelectorAll('.read-more-btn');
      showMoreBtns.forEach(btn => btn.addEventListener('click', function(evt) {
        const btn = evt.currentTarget;
        const target = btn.getAttribute('aria-controls');
        const expanded = btn.getAttribute('aria-expanded');
        const action = expanded == 'false' ? 'Expand' : 'Conceal';
        _paq.push(['trackEvent', 'Content', action, target]);
      }));
    });

    // Track a moulinette result page load
    window.addEventListener('load', function() {
      _paq.push(['trackEvent', 'Simulation', 'Result', {{ department.department }}]);
    });

  </script>

{% endblock %}
