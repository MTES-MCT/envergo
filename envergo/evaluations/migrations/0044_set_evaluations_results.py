# Generated by Django 3.2.6 on 2022-01-06 13:52

from django.db import migrations

# RESULTS
# 1: soumis
# 2: non_soumis
# 3: action_requise


def set_evaluations_results(apps, schema_editor):
    Evaluation = apps.get_model("evaluations", "Evaluation")
    evals = Evaluation.objects.prefetch_related("criterions")
    for eval in evals:
        results = [criterion.result for criterion in eval.criterions.all()]

        if 1 in results:
            eval.result = 1
        else:
            eval.result = 2
        eval.save()


class Migration(migrations.Migration):

    dependencies = [
        ("evaluations", "0043_set_criterions_results"),
    ]

    operations = [
        migrations.RunPython(set_evaluations_results, migrations.RunPython.noop),
    ]
